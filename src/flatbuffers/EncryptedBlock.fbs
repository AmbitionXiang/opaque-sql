// This file is part of the interface between Spark SQL and the SGX enclave --
// the "trusted-untrusted interface," or TUIX.

namespace edu.berkeley.cs.rise.opaque.tuix;

table EncryptedBlock {
    num_rows:uint;
    // When decrypted, this should contain a Rows object at its root
    enc_rows:[ubyte];
}

table EncryptedBlocks {
    blocks:[EncryptedBlock];
    log:LogEntryChain;
}

table SortedRuns {
    runs:[EncryptedBlocks];
}

table LogEntry {
    op:string;
    eid:int;
    job_id:int;
    num_macs:uint;
    mac_lst:[ubyte];
    global_mac:[ubyte];
}

table LogEntryChain {
    curr_entries:[LogEntry];
    past_entries:[LogEntry];
    // HMAC of curr_entry
    // TODO: Separate the input_log_entry for each LogEntryChain->curr_entries() and verify hash over each input log entry
}


/* tuix::CreateLogEntry( */
  /* builder, */
  /* ecall, */
  /* job_id, */
  /* builder.CreateVector(mac_lst, len), */
  /* builder.CreateVector(global_mac, OE_HMAC_SIZE) */
/* ) */
